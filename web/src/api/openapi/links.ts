/**
 * Generated by orval v6.17.0 üç∫
 * Do not edit manually.
 * storyden
 * Storyden social API for building community driven platforms.
 * OpenAPI spec version: 1
 */
import useSwr from "swr";
import type { Key, SWRConfiguration } from "swr";

import { fetcher } from "../client";

import type {
  InternalServerErrorResponse,
  LinkCreateBody,
  LinkCreateOKResponse,
  LinkListOKResponse,
  LinkListParams,
  NotFoundResponse,
} from "./schemas";

type AwaitedInput<T> = PromiseLike<T> | T;

type Awaited<O> = O extends AwaitedInput<infer T> ? T : never;

/**
 * Add a link to the community bookmarks. This will also scrape the content
at the site the link points to, if possible. If the submitted link is an
invalid link for whatever reason (invalid URL structure or page is dead)
then the API will fail. The metadata for the link is indexed on success.

If the submitted link already exists it will be an idempotent operation,
unless the body contains additional metadata. In these cases, the link's
metadata will be updated with the new metadata and the URL is unchanged.

When a link is submitted, it is first "cleaned" to remove any fragments.

 */
export const linkCreate = (linkCreateBody: LinkCreateBody) => {
  return fetcher<LinkCreateOKResponse>({
    url: `/v1/links`,
    method: "post",
    headers: { "Content-Type": "application/json" },
    data: linkCreateBody,
  });
};

/**
 * List all links using the filtering options.
 */
export const linkList = (params?: LinkListParams) => {
  return fetcher<LinkListOKResponse>({
    url: `/v1/links`,
    method: "get",
    params,
  });
};

export const getLinkListKey = (params?: LinkListParams) =>
  [`/v1/links`, ...(params ? [params] : [])] as const;

export type LinkListQueryResult = NonNullable<
  Awaited<ReturnType<typeof linkList>>
>;
export type LinkListQueryError = NotFoundResponse | InternalServerErrorResponse;

export const useLinkList = <
  TError = NotFoundResponse | InternalServerErrorResponse,
>(
  params?: LinkListParams,
  options?: {
    swr?: SWRConfiguration<Awaited<ReturnType<typeof linkList>>, TError> & {
      swrKey?: Key;
      enabled?: boolean;
    };
  },
) => {
  const { swr: swrOptions } = options ?? {};

  const isEnabled = swrOptions?.enabled !== false;
  const swrKey =
    swrOptions?.swrKey ?? (() => (isEnabled ? getLinkListKey(params) : null));
  const swrFn = () => linkList(params);

  const query = useSwr<Awaited<ReturnType<typeof swrFn>>, TError>(
    swrKey,
    swrFn,
    swrOptions,
  );

  return {
    swrKey,
    ...query,
  };
};
